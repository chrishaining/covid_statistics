---
title: "R Notebook"
output: html_notebook
---

another attempt to predict growth rates.
* assumes deaths double every 4 days, so I will use rate of 1.25 per day
* rather than use a single date to extrapolate predictions, this predictor calculates each new daily prediction from the previous day.


**bold**
~~strike~~

```{r}
library(stringr)
library(readr)
library(dplyr)
```

```{r}
#new_deaths=c(uk_deaths[1], diff(uk_deaths))
#mutate(daily_deaths_percent=c((new_deaths[1]/cumulative_deaths)*100))

predictor <- function(start_value) {
    predicted_value <- start_value * 1.25}

#starting figure (this is known)
twenty_six_march <- 463

twenty_seven_march <- predictor(twenty_six_march)
twenty_eight_march <- predictor(twenty_seven_march)
twenty_nine_march <- predictor(twenty_eight_march)
thirty_march <- predictor(twenty_nine_march)
thirty_one_march <- predictor(thirty_march)
one_april <- predictor(thirty_one_march)
two_april <- predictor(one_april)
three_april <- predictor(two_april)
four_april <- predictor(three_april)
five_april <- predictor(four_april)
six_april <- predictor(five_april)
seven_april <- predictor(six_april)
eight_april <- predictor(seven_april)
nine_april <- predictor(eight_april)
ten_april <- predictor(nine_april)
eleven_april <- predictor(ten_april)
twelve_april <- predictor(eleven_april)

#

```

```{r}

date <- as.Date(c('2020-03-26','2020-03-27', '2020-03-28', '2020-03-29', '2020-03-30', '2020-03-31', "2020-04-01", "2020-04-02", "2020-04-03", "2020-04-04", "2020-04-05", "2020-04-06", "2020-04-07", "2020-04-08", "2020-04-09", "2020-04-10", "2020-04-11", "2020-04-12"))
predicted_deaths <- c(twenty_six_march, twenty_seven_march, twenty_eight_march, twenty_nine_march, thirty_march, thirty_one_march, one_april, two_april, three_april, four_april, five_april, six_april, seven_april, eight_april, nine_april, ten_april, eleven_april, twelve_april)
predictions <- data.frame(date, predicted_deaths)

#predictions <- predictions %>% mutate(predicted_deaths=replace(as.numeric(predicted_deaths), date=="2020-03-27", 578))
#predictions <- predictions %>% mutate(predicted_deaths=c(predicted_deaths[1]*1.25*predicted_deaths))
#predictions <- predictions %>% mutate(predicted_deaths=replace(as.numeric(predicted_deaths), date=="2020-03-27", 578))
predictions <- predictions %>% mutate(predicted_deaths=format(predicted_deaths, digits=2))
predictions <- predictions %>% mutate(predicted_deaths=as.numeric(predicted_deaths))

predictions <- predictions %>% mutate(predicted_deaths_third=1.3*(predicted_deaths/1.25))
predictions <- predictions %>% mutate(predicted_deaths_fast=1.5*(predicted_deaths/1.25))
predictions <- predictions %>% rename('Predicted Deaths (25%)'=predicted_deaths, 'Predicted Deaths (30%)'=predicted_deaths_third, 'Predicted Deaths (50%)'=predicted_deaths_fast)

predictions
```

```{r}
#add actual number
empty <- c("NA", "NA", "NA", "NA", "NA", "NA", "NA", "NA", "NA", "NA", "NA")
predictions <- predictions %>% mutate('Actual Deaths'=empty)
predictions
```
```{r}
# 26th isn't a prediction - it's known. So, delete this row
predictions <- predictions %>% filter(date!="2020-03-26")
```

## Predicted Deaths Using Two Growth Rates
Predicted Deaths (25%) predicts what would happen if the rate of growth was 25% a day. That is, it would take about 4 days for the number of deaths to double.

Predicted Deaths (50%) predicts what would happen if the rate of growth was 50% a day. That is, it would take about 2 days for the number of deaths to double.

Actual Deaths: this is the number confirmed by the World Health Organization, based on the number of deaths registered up to and including the relevant date.

Note that the number of deaths registered on a given date may not accurately reflect the number who died. There could be backlogs in the registration system. However, I am assuming that this inaccuracy evens out in the long run.  
```{r}
#add data to actual deaths
predictions <- predictions %>% mutate('Actual Deaths'=replace(as.numeric('Actual Deaths'), date==c("2020-03-27", "2020-03-28", "2020-03-29", "2020-03-30", "2020-03-31", "2020-04-01", "2020-04-02", "2020-04-03", "2020-04-04"), c(578, 759, 1019, 1228, 1408, 1789, 2532, 2921, 3606)))

predictions

```
Note that the figures here may seem to be a day behind the figures in the media. This is because the figures in the table are based on the WHO's situation reports, which are produced the day after the UK announces its figures. For instance, where I give predictions for 2020-03-31 of 1413-1695.6, the UK government announced the relevant figure on 2020-03-30. Even these figures are delayed: the figure that the UK announced on 2020-03-30 reflected the situation at 0900 on 2020-03-29.
[Department of Health and Social Care](https://twitter.com/DHSCgovuk/status/1244651132879806471?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1244651132879806471&ref_url=https%3A%2F%2Fwww.theguardian.com%2Fpolitics%2Flive%2F2020%2Fmar%2F30%2Fuk-coronavirus-live-rate-infection-lockdown-covid-19)

```{r}
# work out actual growth rate
#1 - define function
rater <- function(today_deaths, yesterday_deaths) {1+(today_deaths-yesterday_deaths)/yesterday_deaths}
test <- rater(579, 463)
test
```

```{r}

predictions <- predictions %>% rename(deaths='Actual Deaths')

predictions <- predictions %>% mutate(new_deaths=c(deaths[1], diff(deaths)))
#predictions <- predictions %>% mutate(yesterday=c(deaths[1], diff(deaths)))

predictions <- predictions %>% mutate(rate=1+new_deaths/lag(deaths))
predictions <- predictions %>% mutate(rate=format(rate, digits = 2))
#predictions <- predictions %>% mutate(rate=c(1+new_deaths[1]/deaths))
predictions <- predictions %>% mutate(new_deaths=replace(as.numeric(new_deaths), date=="2020-03-27", NA))
predictions
```

```{r}
library(lubridate)
#average growth rate (cumulative, from 2020-03-28 to most recent stats)
predictions <- predictions %>% mutate(rate=as.numeric(rate))
excludes_first_row <- predictions %>% filter(date!="2020-03-27")
cumulative <- excludes_first_row %>% filter(date < today())

cumulative_mean_growth_rate <- cumulative %>% summarize(mean(rate))
str_glue("Cumulative mean growth rate starting 28th March: {cumulative_mean_growth_rate}")

#average growth rate (last five days) I'd like to automate this, but for now I will make a new variable every day
#over time, I expect to see the mean for the last five days fall. 
last_five_days <- cumulative %>% filter(date >"2020-03-28")
#last_five_days
last_five_days_mean_growth_rate <- last_five_days %>% summarize(mean(rate))
str_glue("Last five days mean growth rate (28th March-2nd April): {last_five_days_mean_growth_rate}")

five_days_to_third_april <- last_five_days %>% filter(date > "2020-03-29")
five_days_to_third_april_mean_growth_rate <- five_days_to_third_april %>% summarize(mean(rate))

str_glue("Last five days mean growth rate (29th March-3rd April): {five_days_to_third_april_mean_growth_rate}")

#five_days_to_fourth_april <- last_five_days %>% filter(date > "2020-03-30")
#five_days_to_fourth_april_mean_growth_rate <- five_days_to_fourth_april %>% summarize(mean(rate))

#str_glue("Last five days mean growth rate (30th March-4th April): {five_days_to_fourth_april_mean_growth_rate}")

```



```{r}
# for comparison, log the known daily growth rate
known_cases <- read.csv('covid_19_deaths.csv')
known_cases <- known_cases %>% select(-Global.Deaths)
known_cases <- known_cases %>% mutate(new_deaths=c(UK.Deaths[1], diff(UK.Deaths)))
known_cases <- known_cases %>% mutate(rate=1+new_deaths/lag(UK.Deaths))
known_cases <- known_cases %>% mutate(rate=format(rate, digits = 2))

known_cases
```

