---
title: "R Notebook"
output: html_notebook
---

another attempt to predict growth rates.
* assumes deaths double every 4 days, so I will use rate of 1.25 per day
* rather than use a single date to extrapolate predictions, this predictor calculates each new daily prediction from the previous day.


**bold**
~~strike~~

```{r}
library(stringr)
library(readr)
library(dplyr)
```

```{r}
#new_deaths=c(uk_deaths[1], diff(uk_deaths))
#mutate(daily_deaths_percent=c((new_deaths[1]/cumulative_deaths)*100))

predictor <- function(start_value) {
    predicted_value <- start_value * 1.25}

#starting figure (this is known)
twenty_six_march <- 463

twenty_seven_march <- predictor(twenty_six_march)
twenty_eight_march <- predictor(twenty_seven_march)
twenty_nine_march <- predictor(twenty_eight_march)
thirty_march <- predictor(twenty_nine_march)
thirty_one_march <- predictor(thirty_march)

#

```

```{r}

date <- as.Date(c('2020-03-26','2020-03-27', '2020-03-28', '2020-03-29', '2020-03-30', '2020-03-31'))
predicted_deaths <- c(twenty_six_march, twenty_seven_march, twenty_eight_march, twenty_nine_march, thirty_march, thirty_one_march)
predictions <- data.frame(date, predicted_deaths)

#predictions <- predictions %>% mutate(predicted_deaths=replace(as.numeric(predicted_deaths), date=="2020-03-27", 578))
#predictions <- predictions %>% mutate(predicted_deaths=c(predicted_deaths[1]*1.25*predicted_deaths))
#predictions <- predictions %>% mutate(predicted_deaths=replace(as.numeric(predicted_deaths), date=="2020-03-27", 578))
predictions <- predictions %>% mutate(predicted_deaths=format(predicted_deaths, digits=2))
predictions <- predictions %>% mutate(predicted_deaths=as.numeric(predicted_deaths))


predictions <- predictions %>% mutate(predicted_deaths_fast=1.5*(predicted_deaths/1.25))
predictions <- predictions %>% rename('Predicted Deaths (25%)'=predicted_deaths, 'Predicted Deaths (50%)'=predicted_deaths_fast)
predictions
```

```{r}
#add actual number
empty <- c("NA", "NA", "NA", "NA", "NA", "NA")
predictions <- predictions %>% mutate('Actual Deaths'=empty)
predictions
```
```{r}
# 26th isn't a prediction - it's known. So, delete this row
predictions <- predictions %>% filter(date!="2020-03-26")
```

## Predicted Deaths Using Two Growth Rates
Predicted Deaths (25%) predicts what would happen if the rate of growth was 25% a day. That is, it would take about 4 days for the number of deaths to double.

Predicted Deaths (50%) predicts what would happen if the rate of growth was 50% a day. That is, it would take about 2 days for the number of deaths to double.

Actual Deaths: this is the number confirmed by the World Health Organization, based on the number of deaths registered up to and including the relevant date.

Note that the number of deaths registered on a given date may not accurately reflect the number who died. There could be backlogs in the registration system. However, I am assuming that this inaccuracy evens out in the long run.  
```{r}
#add data to actual deaths
predictions <- predictions %>% mutate('Actual Deaths'=replace(as.numeric('Actual Deaths'), date==c( "2020-03-27", "2020-03-28"), c(578,759)))

predictions

```

```{r}
# work out actual growth rate
#1 - define function
rater <- function(today_deaths, yesterday_deaths) {1+(today_deaths-yesterday_deaths)/yesterday_deaths}
test <- rater(579, 463)
test
```

```{r}

#predictions <- predictions %>% rename(deaths='Actual Deaths')

predictions <- predictions %>% mutate(new_deaths=c(deaths[1], diff(deaths)))
#predictions <- predictions %>% mutate(yesterday=c(deaths[1], diff(deaths)))

predictions <- predictions %>% mutate(rate=1+new_deaths/lag(deaths))
predictions <- predictions %>% mutate(rate=format(rate, digits = 2))
#predictions <- predictions %>% mutate(rate=c(1+new_deaths[1]/deaths))
predictions
```

```{r}
# for comparison, log the known daily growth rate
known_cases <- read.csv('covid_19_deaths.csv')
known_cases <- known_cases %>% select(-Global.Deaths)
known_cases <- known_cases %>% mutate(new_deaths=c(UK.Deaths[1], diff(UK.Deaths)))
known_cases <- known_cases %>% mutate(rate=1+new_deaths/lag(UK.Deaths))
known_cases <- known_cases %>% mutate(rate=format(rate, digits = 2))

known_cases
```

